
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Homepage Jan Baer">
    <title>Set-acl with Powershell - Homepage Jan Baer</title>
    <meta name="author" content="Jan Baer">
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="In meinem letzten Projekt war eine meiner Aufgaben, ein Script zu erstellen, das eine definierte Verzeichnisstruktur erstellt und einem bestimmten User die notwendigen Zugriffrechte darauf gibt.Weiter">
<meta name="keywords" content="powershell,iis,security">
<meta property="og:type" content="blog">
<meta property="og:title" content="Set-acl with Powershell">
<meta property="og:url" content="https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/index.html">
<meta property="og:site_name" content="Homepage Jan Baer">
<meta property="og:description" content="In meinem letzten Projekt war eine meiner Aufgaben, ein Script zu erstellen, das eine definierte Verzeichnisstruktur erstellt und einem bestimmten User die notwendigen Zugriffrechte darauf gibt.Weiter">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-04-01T12:05:18.571Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Set-acl with Powershell">
<meta name="twitter:description" content="In meinem letzten Projekt war eine meiner Aufgaben, ein Script zu erstellen, das eine definierte Verzeichnisstruktur erstellt und einem bestimmten User die notwendigen Zugriffrechte darauf gibt.Weiter">
<meta name="twitter:creator" content="@reabnaj">
    
    
    
        <meta property="og:image" content="/assets/images/https:/avatars2.githubusercontent.com/u/528331?v=3&s=140"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css">
    <!--STYLES END-->
    

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Homepage Jan Baer</a>
    </h1>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="https://avatars2.githubusercontent.com/u/528331?v=3&amp;s=140">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="3">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="https://avatars2.githubusercontent.com/u/528331?v=3&amp;s=140">
            </a>
            <span class="sidebar-profile-name">Jan Baer</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="/ ">
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="/projects.html">
                
                    <i class="sidebar-button-icon fa fa-lg fa-book"></i>
                    <span class="sidebar-button-desc">MyProjects</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="/all-categories">
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="/all-tags">
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="/all-archives">
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="#about">
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="https://github.com/janbaer" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="https://twitter.com/reabnaj" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a class="sidebar-button-link " href="/atom.xml">
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Set-acl with Powershell
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Mon Apr 01 2013 00:00:00 GMT+0200">
	
		    Apr 01, 2013
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/develop/">develop</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>In meinem letzten Projekt war eine meiner Aufgaben, ein Script zu erstellen, das eine definierte Verzeichnisstruktur erstellt und einem bestimmten User die notwendigen Zugriffrechte darauf gibt.<br>Weiterhin sollte das Script dann im IIS eine Website mit einem eigenen AppPool in diesem Verzeichnis erstellen.</p>
<p>Ich hatte mich entschieden, das Script mit Powershell zu erstellen, da es hier schon fertige Module von Microsoft gibt, um den IIS zu verwalten, ohne das man dies über WMI machen müsste.</p>
<p>Um dieses Modul allerdings zu verwenden, muss man es in Powershell erst einmal importieren. Das macht man ganz einfach mit foldener Codezeile.</p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Import</span>-<span class="keyword">Module</span> -<span class="keyword">Name</span> WebAdministration</span><br></pre></td></tr></table></figure>
<p>Damit das Module importiert werden kann, muss der IIS mit den Management Services installiert sein. Will man prüfen, ob das Modul auch wirklich installiert ist, so kann man das mit folgendem Code machen und im negativen Fall den Benutzer darauf hinweisen.</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">if </span>((<span class="built_in">get-module</span> -<span class="string">name </span><span class="string">WebAdministration </span>-<span class="string">erroraction </span><span class="string">silentlycontinue)</span> -<span class="string">eq </span>$<span class="string">false)</span> &#123;</span><br><span class="line"><span class="string">Write-Host </span><span class="string">"The Powershell module for WebAdministration is not installed! Please check your IIS installation!"</span> -f <span class="string">Red</span></span><br><span class="line"><span class="string">return</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Die Website erstellt man dann mit folgendem Code</p>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$integrated</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">New</span>-WebAppPool -Name <span class="built_in">$appPoolName</span></span><br><span class="line"><span class="keyword">Set</span>-ItemProperty IIS:AppPools\<span class="built_in">$appPoolName</span> managedRuntimeVersion v4.0</span><br><span class="line"><span class="keyword">Set</span>-ItemProperty IIS:AppPools\<span class="built_in">$appPoolName</span> managedPipelineMode <span class="built_in">$integrated</span></span><br><span class="line"><span class="keyword">New</span>-Website -Name <span class="built_in">$webServiceName</span> -PhysicalPath <span class="built_in">$directoryPath</span> -ApplicationPool <span class="built_in">$appPoolName</span></span><br><span class="line">Remove-WebBinding -Name <span class="built_in">$webServiceName</span></span><br><span class="line"><span class="keyword">New</span>-WebBinding -Name <span class="built_in">$webServiceName</span> -IPAddress <span class="string">"*"</span> -Port <span class="built_in">$port</span> -HostHeader <span class="built_in">$webServiceName</span></span><br></pre></td></tr></table></figure>
<p>Seit IIS7 ist es so, das der AppPool nicht mehr wie früher mit dem Account <strong>NetworkService</strong> läuft sondern es dafür eigene <strong>IIS AppPool</strong> Identities gibt. Wenn man einen neuen AppPool erstellt, läuft dieser unter dem Benutzer <strong>IIS AppPools\AppPoolname</strong>. Es müssen diesem Benutzer noch die Zugriffsrechte auf das Verzeichnis gegeben werden. Normalerweise sollten diesem Benutzer nur auf bestimmte Verzeichniss, wie das Log-Verzeichnis Schreibrechte gegeben werden. Auf die anderen Verzeichniss reichen Lesezugriffsrechte. Auch hierfür hat die Powershell schon die notwendigen Commandlets an Board.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$acl</span> = Get-Acl -Path <span class="variable">$directory</span></span><br><span class="line"><span class="variable">$userAccount</span> = New-Object System<span class="selector-class">.Security</span><span class="selector-class">.Principal</span><span class="selector-class">.NTAccount</span>(<span class="string">"IIS AppPool"</span>, <span class="variable">$userName</span>)</span><br><span class="line"><span class="variable">$permission</span> = <span class="variable">$userAccount</span>, <span class="variable">$right</span>, <span class="string">"ContainerInherit,ObjectInherit"</span>, <span class="string">"None"</span>, <span class="string">"Allow"</span></span><br><span class="line"><span class="variable">$right</span> = New-Object System<span class="selector-class">.Security</span><span class="selector-class">.AccessControl</span><span class="selector-class">.FileSystemAccessRule</span> <span class="variable">$permission</span></span><br><span class="line"><span class="variable">$acl</span>.SetAccessRule(<span class="variable">$right</span>)</span><br><span class="line">Set-Acl -AclObject <span class="variable">$acl</span> -Path <span class="variable">$directory</span></span><br></pre></td></tr></table></figure>
<p>Die meisten Codebeispiele erstellen die Permission mit der folgenden Codezeile</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$permission = $userAccount, $right</span><br></pre></td></tr></table></figure>
<p>Das hat aber den Nachteil, das sich diese Berechtigung nicht auf neue Unterordner veerbt. Deswegen ist die erste Variante in den meisten Fällen sicher die zu bevorzugende.</p>

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/iis/">iis</a> <a class="tag tag--primary tag--small t-link" href="/tags/powershell/">powershell</a> <a class="tag tag--primary tag--small t-link" href="/tags/security/">security</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2013/09/01/2013-09-01-using-hooks-in-git/" data-tooltip="Using hooks in git">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2013/03/04/2013-03-04-linqperformancetips/" data-tooltip="LinqPerformanceTips">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 Jan Baer. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2013/09/01/2013-09-01-using-hooks-in-git/" data-tooltip="Using hooks in git">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2013/03/04/2013-03-04-linqperformancetips/" data-tooltip="LinqPerformanceTips">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://www.janbaer.de/2013/04/01/2013-04-01-set-acl-with-powershell/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <!-- Define author's picture -->


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="https://avatars2.githubusercontent.com/u/528331?v=3&amp;s=140">
        
            <h4 id="about-card-name">Jan Baer</h4>
        
            <h5 id="about-card-bio"><p>I’m a passionated Softwaredeveloper from Munich.</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>Softwaredeveloper</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br>
                Germany
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js"></script>
<!--SCRIPTS END-->



</html>
